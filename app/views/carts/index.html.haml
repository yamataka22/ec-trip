- content_for :stylesheet do
  = stylesheet_link_tag 'front/cart'
.cart_index
  - flash_messages
  - if current_member.carts&.size > 0
    .text-center.mt-4.mb-3
      %p.lead= "合計（#{current_member.counts_cart}点）:#{jpy(current_member.total_cart_amount, prefix: true, tax: :exclude)}"
      = link_to new_purchase_path, class: 'btn btn-warning btn-raised' do
        %i.fa.fa-arrow-right
        レジへ進む
    .card
      .card-body
        %table.table.cart_list.table-hover
          %thead
            %tr
              %th.text-center 削除
              %th{colspan: 2} 商品
              %th 数量
          %tbody
            - @carts.each do |cart|
              %tr
                %td.text-center
                  = link_to member_cart_path(cart), method: :delete do
                    %i.fa.fa-times.fa-lg
                %td.img_td
                  = link_to item_path(cart.item) do
                    = image_tag cart.item.caption_image_url
                %td
                  %h4.item_title= cart.item.name
                  %p.text-muted= jpy(cart.item.price, prefix: true)
                  %p.view_pc= cart.item.description
                %td
                  = form_for cart, url: member_cart_path(cart), class: 'form-inline' do |f|
                    - max_quantity = cart.item.stock_quantity < 5 ? cart.item.stock_quantity : 5
                    = f.select :quantity, options_for_select((1..max_quantity).to_a, selected: cart.quantity), {}, {class: 'form-control quantity_select'}
  - else
    .text-center
      .alert.alert-primary カートに商品がありません
      = link_to '商品を探す', items_path, class: 'btn btn-secondary'
- content_for :javascript do
  :javascript
    $(document).ready(function(){
       $('.quantity_select').change(function() {
           $(this).parents('form').submit();
       })
    });